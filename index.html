<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Open Person Pages</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        .error-message {
            color: red;
            font-weight: bold;
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <textarea id="inputIDs" placeholder="Enter each FamilySearch ID on a new line (ID example: ABCD-123)" rows="5"
        cols="50"></textarea>

    <input type="checkbox" id="preventOpenOnInvalidID">
    <label for="preventOpenOnInvalidID">Prevent opening tabs for invalid IDs</label>

    <button onclick="openPages()">Open Person Pages</button>

    <p id="errorMessage" class="error-message"></p>

    <script>
        function openPages() {
            // Retrieve the input IDs
            const inputIDs = document.getElementById('inputIDs').value;
            // Split the input IDs into an array
            const idArray = inputIDs.split(/[,|\n]+/);

            // Initialize error message and skip opening tabs flag
            let errorMessage = '';
            let skipOpeningTabs = false;

            // Check each ID for validity
            for (const id of idArray) {
                // Check if the ID is valid
                if (!isValidId(id)) {
                    // Add the invalid ID to the error message
                    errorMessage += `Invalid ID: ${id}\n`;
                    // Set skip opening tabs flag to true
                    skipOpeningTabs = true;
                }
            }

            // Update the error message element
            if (errorMessage) {
                document.getElementById('errorMessage').textContent = errorMessage;
            } else {
                document.getElementById('errorMessage').textContent = '';
            }

            // Open tabs for valid IDs if the checkbox is unchecked
            if (!skipOpeningTabs && !document.getElementById('preventOpenOnInvalidID').checked) {
                // Iterate through the IDs
                for (const id of idArray) {
                    // Check if the ID is valid
                    if (isValidId(id)) {
                        // Construct the URL for the person page
                        const url = `https://www.familysearch.org/tree/person/ordinances/${id}`;
                        // Open the person page in a new tab
                        window.open(url, '_blank');
                    }
                }
            }
        }

        function isValidId(id) {
            // Define a regular expression for valid IDs
            const regex = /^[A-Z0-9]{4}-[A-Z0-9]{3}$/;
            // Return whether the ID matches the regex
            return regex.test(id);
        }
    </script>
</body>

</html>